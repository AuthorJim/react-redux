# Redux尝鲜

## Redux的基本原则

Flux的基本原则是“单向数据流”，Redux在此基础上强调了三个原则：

- 唯一数据源
- 保持状态只读
- 数据改变只能通过纯函数完成

### 唯一数据源

> 唯一数据源指的是应用的状态数据应该只存储在唯一的一个Store上

在整个应用中只保持一个Store，所有组件的数据源就是这个Store上的状态。

这个唯一Store上的状态，是一个树形的形象，每个组件往往只是用树形对象上一部分的数据，而如何设计Store上状态的结构，就是Redux应用的核心问题。

### 保持状态只读

保持状态只读，就是说不能直接去修改状态，要修改Store的状态，必须通过派发一个action对象完成。

### 数据改变只能通过纯函数完成

这里说的纯函数就是Reducer。按照Redux创始人的说法，Redux=Reducer+Flux

Reducer并不是一个Redux特定的术语，而是一个计算机科学中的通用概念。在JavaScrit中，数组类型就有reduce函数，接受的参数就是一个reducer，reduce做的事情就是把数组所有元素依次做“规约”，对每个元素都调用一个参数reducer，通过reducer函数完成规约所有元素的功能
```js
[1, 2, 3, 4].reduce(function reducer(accumulation, item) {
    return accumulation + item
}, 0)
```

在Redux中，每个reducer函数签名如下所示：
```js
reducer(state, action)
```

第一个参数state是当前的状态， 第二个参数action是接受到的action对象，而reducer函数要做的事情，就是根据state和action的值产生一个新的对象返回，注意reducer必须是纯函数，也就是说函数的返回必须完全由参数state和action决定，而且不产生任何副作用。


## 容器组件和傻瓜组件

在Redux框架下，一个React组件基本上就是要完成以下两个功能：

- 和Redux打交道，读取Store状态，用于初始化组件状态，同时要监听Store的状态改变；当Store状态发生改变时，需要更新组件的状态，从而驱动组件重新渲染；当需要更新Store状态时，就要派发action对象
- 根据当前的state和props渲染用户页面

让一个组件只专注做一件事，是React组件设计的原则。如果发现一个组件做的事情太多了，就可以把这个组件拆分成多个组件，让每个组件依然只专注一件事。 

如果说一个React组件需要包办上面的两个任务，我们可以考虑将它拆分为两个组件，分别承担一个任务，然后把两个组件嵌套起来，完成原本一个组件完成的所有任务。

在这样的关系里，两个组件是父子组件关系。承担第一个任务的组件，也就是负责和Redux Store打交道的处于外层，所以称为容器组件；对承担第二个任务只专心负责渲染页面的组件处于内层，叫做展示组件。

容器组件又叫聪明组件，内层展示组件又叫傻瓜组件。傻瓜组件就是一个纯函数，根据props产生结果。说是傻瓜，倒是体现了计算机编程中的大智慧，大智若愚。而容器组件做的事情只是涉及一些状态转换。在我们将一个组件拆分为容器组件和傻瓜组件后，不只是功能的分离，还有一个比较大的变化那就是傻瓜组件不需要状态了。

让傻瓜组件没有状态是我们的拆分目的之一，傻瓜组件只需要根据props来渲染结果，不需要state。傻瓜组件的状态全部交给容器组件打点，通过容器组件的props将状态传递给傻瓜组件。