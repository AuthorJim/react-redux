# 组件的生命周期

React严格定义了组件的生命周期，每个组件的生命周期可能会经历一下三个过程

- 装载过程（Mount），也就是把组件第一次在DOM树中渲染的过程
- 更新过程（Update），当组件被重新渲染
- 卸载过程（Unmount）， 组件从DOM中删除的过程

三个不同的过程，React库会一次调用组件的一些成员函数，这些函数被称为生命周期函数。所以要定制一个React组件，实际上就是定制这些生命周期函数。

## 装载过程

当组件第一次被渲染时，依次调用的函数是如下这些

- constructor
- getInitialState
- getDefaultProps
- componentWillMount
- render
- componentDidMount

### constructor

要创建一个组件类的实例，当然会调用相应的构造函数。不过，不是每个组件都需要定义自己的构造函数。对于无状态的React组件往往不需要定义构造函数

对于一个React组件需要定义自己的构造函数，往往是因为一下两点

- 初始化state
- 绑定成员函数到this环境

### getInitialState && getInitialState

getInitialState这个函数的返回值会用来初始化组件的this.state，getInitialState函数的返回值可以作为props的初始值，不过两个函数只有在React.createClass方法创造的组件类才会发生作用。

在使用ES6定义的React组件中，我们在构造函数里对this.state赋值完成初始化，通过给类属性（不是类的实例对象属性）defaultProps赋值指定props的初始值

### render

render函数是React组件中最重要最必不可少的函数。一个React组件可以不包含其他所有的函数，但一定要实现render函数，因为所有React组件的父类React.Component类除了render之外的生命周期函数都有默认实现。

通常一个组件要发挥作用，总要渲染一些东西。render函数并不做实际的渲染动作，它只是返回一个JSX描述的结构，最终由React来操作渲染过程。

需要注意render函数应该是一个纯函数，完全根据this.state和this.props来决定返回的结果，而且不要产生任何副作用。在render函数中去调用this.setState毫无疑问是错误的，因为一个纯函数不应该引起状态的改变。

### componentWillMount && componentDidMount

在装载过程中，componentWillMount与componentDidMount会分别在render函数的一前一后调用，把render函数夹住，正好做render前后必要的工作。

不过通常不用定义componentWillMount函数，顾名思义，componentWillMount发生在组件将要装载的时候，这个时候没有任何的渲染效果。换句话说，所有可以在componentWillMount中做的事情，都可以放到constructor中去做。

render函数调用完之后，componentDidMount函数并不是会被立即调用，componentDidMount被调用的时候，render函数返回的东西已经引发了渲染，组件已经被挂载到了DOM树上。

componentWillMount可以在浏览器端和服务器端调用，componentDidMount只能在浏览器端被调用。

## 更新过程

装载后的组件需要随着用户的操作改变展现内容，当props或state被修改的时候，就会引发组件的更新过程。

更新过程会依次调用下面的生命周期函数，其中render函数和装载过程一样。

- componentWillReceiveProps
- shouldComponentUpdate
- componentWillUpdate
- render
- componentDidUpdate

### componentWillReceiveProps(nextProps)

只要是父组件的render函数被调用，在render函数里面渲染的子组件就会经历更新过程。不管父组件传给子组件的props有没有改变，都会触发子组件的componentWillReceiveProps

### shouldComponentUpdate(nextProps, nextState)

除了render函数，shouldComponentUpdate可能是React组件的生命周期中最重要的一个函数。

render函数觉得了组件该渲染什么，shouldComponentUpdate决定了一个组件什么时候不需要渲染。

 render和shouldComponentUpdate函数，也是React生命周期中味儿两个要求有返回结果的函数。render函数的结果用于构造DOM对象，而shouldComponentUpdate函数返回一个布尔值，告诉React这个组件在这次更新过程中是否继续。

 在更新的过程中，React首先调用shouldComponentUpdate函数，如果这个函数返回true，那就继续更新过程，接下来调用render函数。反正，如果得到一个false，那就立刻停止更新过程，也就不会引发后续的渲染了。

 shouldComponentUpdate只要使用恰当，能大大提高React渲染性能，如果它发现不需要重新渲染。那就干脆不渲染。

 ### componentWillUpdate && componentWillUpdate

 如果组件的shouldComponentUpdate函数返回true，React接下来就会调用对应组件的componentWillUpdate、render和componentDidUpdate函数。

 componentWillMount和componentDidMount，componentWillUpdate和componentWillUpdate，这两对函数一前一后地把render是夹在中间。

 ## 卸载过程

 React组件的卸载过程只涉及一个函数componentWillUnmount，当React组件要从DOM树上删除之前，对应的componentWillUnmount就会被调用，这个函数适合做一些请理性工作。

